{"ast":null,"code":"import { query as q } from 'faunadb';\nimport { fauna } from \"../../../services/fauna\";\nimport { stripe } from '../../../services/stripe';\nexport async function saveSubscription(subscriptionId, customerId) {\n  const userRef = await fauna.query(q.Select(\"ref\", q.Get(q.Match(q.Index('user_by_stripe_customer_id'), customerId))));\n  const subscription = await stripe.subscriptions.retrieve(subscriptionId);\n  const subscriptionData = {\n    id: subscription.id,\n    userId: userRef,\n    status: subscription.status,\n    price_id: subscription.items.data[0].price.id\n  };\n  await fauna.query(q.Create(q.Collection('subscriptions'), {\n    data: subscriptionData\n  }));\n}","map":{"version":3,"sources":["/home/rodolfo/Documents/Estudo/Ignite/NextJS/Aulas/ignews/Ignite-Ig.News/src/pages/api/_lib/manageSubscription.ts"],"names":["query","q","fauna","stripe","saveSubscription","subscriptionId","customerId","userRef","Select","Get","Match","Index","subscription","subscriptions","retrieve","subscriptionData","id","userId","status","price_id","items","data","price","Create","Collection"],"mappings":"AAAA,SAASA,KAAK,IAAIC,CAAlB,QAA2B,SAA3B;AAEA,SAASC,KAAT,QAAsB,yBAAtB;AACA,SAASC,MAAT,QAAuB,0BAAvB;AAEA,OAAO,eAAeC,gBAAf,CACLC,cADK,EAELC,UAFK,EAGL;AACA,QAAMC,OAAO,GAAG,MAAML,KAAK,CAACF,KAAN,CACpBC,CAAC,CAACO,MAAF,CACE,KADF,EAEEP,CAAC,CAACQ,GAAF,CACER,CAAC,CAACS,KAAF,CACET,CAAC,CAACU,KAAF,CAAQ,4BAAR,CADF,EAEEL,UAFF,CADF,CAFF,CADoB,CAAtB;AAYA,QAAMM,YAAY,GAAG,MAAMT,MAAM,CAACU,aAAP,CAAqBC,QAArB,CAA8BT,cAA9B,CAA3B;AAEA,QAAMU,gBAAgB,GAAG;AACvBC,IAAAA,EAAE,EAAEJ,YAAY,CAACI,EADM;AAEvBC,IAAAA,MAAM,EAAEV,OAFe;AAGvBW,IAAAA,MAAM,EAAEN,YAAY,CAACM,MAHE;AAIvBC,IAAAA,QAAQ,EAAEP,YAAY,CAACQ,KAAb,CAAmBC,IAAnB,CAAwB,CAAxB,EAA2BC,KAA3B,CAAiCN;AAJpB,GAAzB;AAOA,QAAMd,KAAK,CAACF,KAAN,CACJC,CAAC,CAACsB,MAAF,CACEtB,CAAC,CAACuB,UAAF,CAAa,eAAb,CADF,EAEE;AAAEH,IAAAA,IAAI,EAAEN;AAAR,GAFF,CADI,CAAN;AAOD","sourcesContent":["import { query as q } from 'faunadb'\n\nimport { fauna } from \"../../../services/fauna\"\nimport { stripe } from '../../../services/stripe'\n\nexport async function saveSubscription(\n  subscriptionId: string,\n  customerId: string,\n) {\n  const userRef = await fauna.query(\n    q.Select(\n      \"ref\",\n      q.Get(\n        q.Match(\n          q.Index('user_by_stripe_customer_id'),\n          customerId\n        )\n      )\n    )\n  )\n\n  const subscription = await stripe.subscriptions.retrieve(subscriptionId)\n\n  const subscriptionData = {\n    id: subscription.id,\n    userId: userRef,\n    status: subscription.status,\n    price_id: subscription.items.data[0].price.id\n  }\n\n  await fauna.query(\n    q.Create(\n      q.Collection('subscriptions'),\n      { data: subscriptionData }\n    )\n  )\n\n}"]},"metadata":{},"sourceType":"module"}