{"ast":null,"code":"import _regeneratorRuntime from \"/home/rodolfo/Documents/Estudo/Ignite/NextJS/Aulas/ignews/Ignite-Ig.News/node_modules/@babel/runtime/regenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _asyncToGenerator from \"/home/rodolfo/Documents/Estudo/Ignite/NextJS/Aulas/ignews/Ignite-Ig.News/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/rodolfo/Documents/Estudo/Ignite/NextJS/Aulas/ignews/Ignite-Ig.News/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/rodolfo/Documents/Estudo/Ignite/NextJS/Aulas/ignews/Ignite-Ig.News/src/components/SubscribeButton/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { signIn, useSession } from 'next-auth/client';\nimport { useRouter } from 'next/router';\nimport { api } from '../../services/api';\nimport { getStripeJs } from '../../services/stripe-js';\nimport styles from './styles.module.scss';\nexport function SubscribeButton(_ref) {\n  _s();\n\n  var priceId = _ref.priceId;\n\n  var _useSession = useSession(),\n      _useSession2 = _slicedToArray(_useSession, 1),\n      session = _useSession2[0];\n\n  var router = useRouter();\n\n  function handleSubscribe() {\n    return _handleSubscribe.apply(this, arguments);\n  }\n\n  function _handleSubscribe() {\n    _handleSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var response, sessionId, stripe;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (session) {\n                _context.next = 3;\n                break;\n              }\n\n              signIn('github');\n              return _context.abrupt(\"return\");\n\n            case 3:\n              if (!session.activeSubscription) {\n                _context.next = 6;\n                break;\n              }\n\n              router.push('/posts');\n              return _context.abrupt(\"return\");\n\n            case 6:\n              _context.prev = 6;\n              _context.next = 9;\n              return api.post('/subscribe');\n\n            case 9:\n              response = _context.sent;\n              sessionId = response.data.sessionId;\n              _context.next = 13;\n              return getStripeJs();\n\n            case 13:\n              stripe = _context.sent;\n              _context.next = 16;\n              return stripe.redirectToCheckout({\n                sessionId: sessionId\n              });\n\n            case 16:\n              _context.next = 21;\n              break;\n\n            case 18:\n              _context.prev = 18;\n              _context.t0 = _context[\"catch\"](6);\n              alert(_context.t0.message);\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[6, 18]]);\n    }));\n    return _handleSubscribe.apply(this, arguments);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    type: \"button\",\n    className: styles.subscribeButton,\n    onClick: handleSubscribe,\n    children: \"Subscribe now\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 39,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SubscribeButton, \"wRjH18ZEAU0r8MGsdyiQ8/tDc2w=\", false, function () {\n  return [useSession, useRouter];\n});\n\n_c = SubscribeButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"SubscribeButton\");","map":{"version":3,"sources":["/home/rodolfo/Documents/Estudo/Ignite/NextJS/Aulas/ignews/Ignite-Ig.News/src/components/SubscribeButton/index.tsx"],"names":["signIn","useSession","useRouter","api","getStripeJs","styles","SubscribeButton","priceId","session","router","handleSubscribe","activeSubscription","push","post","response","sessionId","data","stripe","redirectToCheckout","alert","message","subscribeButton"],"mappings":";;;;;;;;AAAA,SAASA,MAAT,EAAiBC,UAAjB,QAAmC,kBAAnC;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,GAAT,QAAoB,oBAApB;AACA,SAASC,WAAT,QAA4B,0BAA5B;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AAMA,OAAO,SAASC,eAAT,OAA4D;AAAA;;AAAA,MAAjCC,OAAiC,QAAjCA,OAAiC;;AAAA,oBAC/CN,UAAU,EADqC;AAAA;AAAA,MAC1DO,OAD0D;;AAEjE,MAAMC,MAAM,GAAGP,SAAS,EAAxB;;AAFiE,WAIlDQ,eAJkD;AAAA;AAAA;;AAAA;AAAA,gFAIjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACOF,OADP;AAAA;AAAA;AAAA;;AAEIR,cAAAA,MAAM,CAAC,QAAD,CAAN;AAFJ;;AAAA;AAAA,mBAMMQ,OAAO,CAACG,kBANd;AAAA;AAAA;AAAA;;AAOIF,cAAAA,MAAM,CAACG,IAAP,CAAY,QAAZ;AAPJ;;AAAA;AAAA;AAAA;AAAA,qBAY2BT,GAAG,CAACU,IAAJ,CAAS,YAAT,CAZ3B;;AAAA;AAYUC,cAAAA,QAZV;AAaYC,cAAAA,SAbZ,GAa0BD,QAAQ,CAACE,IAbnC,CAaYD,SAbZ;AAAA;AAAA,qBAeyBX,WAAW,EAfpC;;AAAA;AAeUa,cAAAA,MAfV;AAAA;AAAA,qBAgBUA,MAAM,CAACC,kBAAP,CAA0B;AAAEH,gBAAAA,SAAS,EAATA;AAAF,eAA1B,CAhBV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAmBII,cAAAA,KAAK,CAAC,YAAIC,OAAL,CAAL;;AAnBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAJiE;AAAA;AAAA;;AA2BjE,sBACE;AACE,IAAA,IAAI,EAAC,QADP;AAEE,IAAA,SAAS,EAAEf,MAAM,CAACgB,eAFpB;AAGE,IAAA,OAAO,EAAEX,eAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AASD;;GApCeJ,e;UACIL,U,EACHC,S;;;KAFDI,e","sourcesContent":["import { signIn, useSession } from 'next-auth/client'\nimport { useRouter } from 'next/router'\nimport { api } from '../../services/api'\nimport { getStripeJs } from '../../services/stripe-js'\nimport styles from './styles.module.scss'\n\ninterface SubscribeButtonProps {\n  priceId: string\n}\n\nexport function SubscribeButton({ priceId }: SubscribeButtonProps) {\n  const [session] = useSession()\n  const router = useRouter()\n\n  async function handleSubscribe() {\n    if (!session) {\n      signIn('github')\n      return\n    }\n\n    if (session.activeSubscription) {\n      router.push('/posts')\n      return\n    }\n\n    try {\n      const response = await api.post('/subscribe')\n      const { sessionId } = response.data\n\n      const stripe = await getStripeJs()\n      await stripe.redirectToCheckout({ sessionId })\n\n    } catch (err) {\n      alert(err.message)\n    }\n  }\n\n  return (\n    <button\n      type=\"button\"\n      className={styles.subscribeButton}\n      onClick={handleSubscribe}\n    >\n      Subscribe now\n    </button>\n  )\n}"]},"metadata":{},"sourceType":"module"}